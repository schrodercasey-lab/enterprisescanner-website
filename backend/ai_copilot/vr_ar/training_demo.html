<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JUPITER VR Training - Interactive Demo</title>
    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #fff;
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .status-badge {
            display: inline-block;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9em;
            font-weight: bold;
            margin: 10px 5px;
        }

        .status-connected { background: #10b981; }
        .status-disconnected { background: #ef4444; }
        .status-training { background: #f59e0b; }

        .grid {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 25px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
        }

        .card h2 {
            font-size: 1.5em;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .icon { font-size: 1.3em; }

        /* Scenario List */
        .scenario-list {
            max-height: 600px;
            overflow-y: auto;
        }

        .scenario-item {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid transparent;
        }

        .scenario-item:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateX(5px);
        }

        .scenario-item.selected {
            border-color: #10b981;
            background: rgba(16, 185, 129, 0.2);
        }

        .scenario-title {
            font-size: 1.1em;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .scenario-meta {
            font-size: 0.85em;
            opacity: 0.8;
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .difficulty-badge {
            padding: 2px 8px;
            border-radius: 5px;
            font-size: 0.8em;
            font-weight: bold;
        }

        .difficulty-novice { background: #3b82f6; }
        .difficulty-beginner { background: #10b981; }
        .difficulty-intermediate { background: #f59e0b; }
        .difficulty-advanced { background: #ef4444; }
        .difficulty-expert { background: #7c3aed; }

        /* Training Area */
        .training-content {
            min-height: 500px;
        }

        .welcome-screen {
            text-align: center;
            padding: 60px 20px;
        }

        .welcome-screen h3 {
            font-size: 2em;
            margin-bottom: 20px;
        }

        .welcome-screen p {
            font-size: 1.2em;
            opacity: 0.9;
            margin-bottom: 30px;
        }

        /* Training Step */
        .training-step {
            display: none;
        }

        .training-step.active {
            display: block;
            animation: fadeIn 0.5s;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .step-header {
            background: rgba(0, 0, 0, 0.3);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .step-progress {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
        }

        .progress-bar {
            flex: 1;
            height: 8px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 4px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #10b981, #34d399);
            transition: width 0.5s;
        }

        .step-info {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .instructions-list {
            list-style: none;
            padding: 0;
        }

        .instructions-list li {
            padding: 10px;
            margin: 5px 0;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 5px;
            padding-left: 35px;
            position: relative;
        }

        .instructions-list li:before {
            content: "‚úì";
            position: absolute;
            left: 10px;
            color: #10b981;
            font-weight: bold;
        }

        /* Actions Area */
        .actions-area {
            background: rgba(0, 0, 0, 0.3);
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
        }

        .action-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-bottom: 15px;
        }

        .action-btn {
            padding: 12px 20px;
            background: rgba(16, 185, 129, 0.3);
            border: 2px solid #10b981;
            border-radius: 8px;
            color: white;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.95em;
        }

        .action-btn:hover {
            background: rgba(16, 185, 129, 0.5);
            transform: translateY(-2px);
        }

        .action-btn.taken {
            background: rgba(16, 185, 129, 0.8);
            border-color: #059669;
        }

        .control-button {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #10b981, #059669);
            border: none;
            border-radius: 10px;
            color: white;
            font-size: 1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            margin-top: 15px;
        }

        .control-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(16, 185, 129, 0.4);
        }

        .control-button.secondary {
            background: linear-gradient(135deg, #6b7280, #4b5563);
        }

        /* Score Display */
        .score-display {
            display: flex;
            justify-content: space-around;
            margin-top: 20px;
            padding: 15px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
        }

        .score-item {
            text-align: center;
        }

        .score-value {
            font-size: 2em;
            font-weight: bold;
            color: #10b981;
        }

        .score-label {
            font-size: 0.9em;
            opacity: 0.8;
        }

        /* Skill Assessment */
        .skill-assessment {
            margin-top: 20px;
        }

        .skill-level-display {
            text-align: center;
            padding: 30px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            border-radius: 15px;
            margin-bottom: 20px;
        }

        .skill-level {
            font-size: 2.5em;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .category-scores {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }

        .category-score {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 10px;
        }

        .category-name {
            font-size: 0.9em;
            opacity: 0.8;
            margin-bottom: 10px;
        }

        .category-bar {
            height: 8px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 4px;
            overflow: hidden;
        }

        .category-fill {
            height: 100%;
            background: linear-gradient(90deg, #10b981, #34d399);
        }

        /* Feedback */
        .feedback-box {
            background: rgba(16, 185, 129, 0.2);
            border: 2px solid #10b981;
            padding: 15px;
            border-radius: 10px;
            margin-top: 15px;
            display: none;
        }

        .feedback-box.show {
            display: block;
            animation: slideIn 0.3s;
        }

        @keyframes slideIn {
            from { transform: translateY(-10px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        /* Recommendations */
        .recommendations-list {
            list-style: none;
            padding: 0;
        }

        .recommendations-list li {
            padding: 10px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 5px;
            margin: 5px 0;
        }

        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.3);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.5);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üéì JUPITER VR Training System</h1>
            <p>Comprehensive Security Analyst Training & Certification</p>
            <div class="status-badge status-disconnected" id="connectionStatus">Disconnected</div>
            <div class="status-badge status-training" id="trainingStatus" style="display: none;">Not Training</div>
        </div>

        <div class="grid">
            <!-- Left Sidebar: Scenario Selection -->
            <div class="card">
                <h2><span class="icon">üìö</span> Training Scenarios</h2>
                <div class="scenario-list" id="scenarioList">
                    <p style="opacity: 0.7;">Loading scenarios...</p>
                </div>
                
                <button class="control-button" id="startTrainingBtn" disabled>
                    Start Selected Training
                </button>
                
                <button class="control-button secondary" id="assessSkillsBtn" style="margin-top: 10px;">
                    Assess My Skills
                </button>
            </div>

            <!-- Right Panel: Training Content -->
            <div class="card training-content">
                <!-- Welcome Screen -->
                <div class="welcome-screen" id="welcomeScreen">
                    <h3>üëã Welcome to VR Training</h3>
                    <p>Select a training scenario from the left to begin your journey to becoming a security expert.</p>
                    
                    <div class="score-display">
                        <div class="score-item">
                            <div class="score-value" id="totalScenarios">10</div>
                            <div class="score-label">Available Scenarios</div>
                        </div>
                        <div class="score-item">
                            <div class="score-value" id="completedCount">0</div>
                            <div class="score-label">Completed</div>
                        </div>
                        <div class="score-item">
                            <div class="score-value" id="totalPoints">0</div>
                            <div class="score-label">Total Points</div>
                        </div>
                    </div>
                </div>

                <!-- Training Step Display -->
                <div class="training-step" id="trainingStep">
                    <div class="step-header">
                        <div class="step-progress">
                            <span id="stepNumber">Step 1 of 5</span>
                            <div class="progress-bar">
                                <div class="progress-fill" id="progressFill" style="width: 20%;"></div>
                            </div>
                            <span id="stepScore">0 / 100 pts</span>
                        </div>
                        <h3 id="stepTitle">Step Title</h3>
                        <p id="stepDescription" style="opacity: 0.9;"></p>
                    </div>

                    <div class="step-info">
                        <h4 style="margin-bottom: 15px;">üìã Instructions:</h4>
                        <ul class="instructions-list" id="instructionsList">
                            <!-- Instructions will be populated here -->
                        </ul>
                    </div>

                    <div class="actions-area">
                        <h4 style="margin-bottom: 15px;">‚ö° Available Actions:</h4>
                        <div class="action-buttons" id="actionButtons">
                            <!-- Action buttons will be populated here -->
                        </div>

                        <div class="feedback-box" id="feedbackBox">
                            <strong>üí° Feedback:</strong> <span id="feedbackText"></span>
                        </div>

                        <button class="control-button" id="completeStepBtn">
                            Complete This Step
                        </button>
                        <button class="control-button secondary" id="hintBtn">
                            üí° Get Hint
                        </button>
                    </div>

                    <div class="score-display">
                        <div class="score-item">
                            <div class="score-value" id="currentScore">0</div>
                            <div class="score-label">Current Score</div>
                        </div>
                        <div class="score-item">
                            <div class="score-value" id="hintsUsed">0</div>
                            <div class="score-label">Hints Used</div>
                        </div>
                        <div class="score-item">
                            <div class="score-value" id="timeSpent">00:00</div>
                            <div class="score-label">Time Spent</div>
                        </div>
                    </div>
                </div>

                <!-- Skill Assessment Display -->
                <div class="skill-assessment" id="skillAssessment" style="display: none;">
                    <h2 style="margin-bottom: 20px;">üìä Skill Assessment Results</h2>
                    
                    <div class="skill-level-display">
                        <div class="skill-level" id="skillLevel">INTERMEDIATE</div>
                        <p>Overall Score: <span id="overallScore">75</span>/100</p>
                    </div>

                    <h3 style="margin-bottom: 15px;">Category Breakdown:</h3>
                    <div class="category-scores" id="categoryScores">
                        <!-- Categories will be populated here -->
                    </div>

                    <h3 style="margin: 20px 0 15px 0;">üí™ Strengths:</h3>
                    <ul class="recommendations-list" id="strengthsList">
                        <!-- Strengths will be populated here -->
                    </ul>

                    <h3 style="margin: 20px 0 15px 0;">üìà Areas for Improvement:</h3>
                    <ul class="recommendations-list" id="weaknessesList">
                        <!-- Weaknesses will be populated here -->
                    </ul>

                    <h3 style="margin: 20px 0 15px 0;">üéØ Recommended Training:</h3>
                    <ul class="recommendations-list" id="recommendationsList">
                        <!-- Recommendations will be populated here -->
                    </ul>

                    <button class="control-button" id="backToTrainingBtn">
                        Back to Training
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // WebSocket connection
        const socket = io('http://localhost:5011');
        const userId = 'analyst_' + Math.random().toString(36).substr(2, 9);
        
        let scenarios = [];
        let selectedScenario = null;
        let currentStep = null;
        let actionsTaken = [];
        let startTime = null;
        let timerInterval = null;

        // Connection handling
        socket.on('connect', () => {
            console.log('Connected to training server');
            document.getElementById('connectionStatus').className = 'status-badge status-connected';
            document.getElementById('connectionStatus').textContent = 'Connected';
            
            socket.emit('register_user', { user_id: userId });
            loadScenarios();
        });

        socket.on('disconnect', () => {
            document.getElementById('connectionStatus').className = 'status-badge status-disconnected';
            document.getElementById('connectionStatus').textContent = 'Disconnected';
        });

        // Load scenarios
        async function loadScenarios() {
            try {
                const response = await fetch('http://localhost:5011/api/scenarios');
                const data = await response.json();
                scenarios = data.scenarios;
                
                renderScenarios();
                document.getElementById('totalScenarios').textContent = scenarios.length;
            } catch (error) {
                console.error('Error loading scenarios:', error);
            }
        }

        function renderScenarios() {
            const container = document.getElementById('scenarioList');
            container.innerHTML = '';
            
            scenarios.forEach(scenario => {
                const item = document.createElement('div');
                item.className = 'scenario-item';
                item.onclick = () => selectScenario(scenario);
                
                item.innerHTML = `
                    <div class="scenario-title">${scenario.title}</div>
                    <div class="scenario-meta">
                        <span class="difficulty-badge difficulty-${scenario.difficulty}">${scenario.difficulty.toUpperCase()}</span>
                        <span>‚è±Ô∏è ${scenario.duration_minutes} min</span>
                        <span>üéØ ${scenario.total_points} pts</span>
                        <span>üìù ${scenario.steps_count} steps</span>
                    </div>
                    <div style="font-size: 0.85em; opacity: 0.7; margin-top: 5px;">${scenario.description}</div>
                `;
                
                container.appendChild(item);
            });
        }

        function selectScenario(scenario) {
            selectedScenario = scenario;
            
            // Update UI
            document.querySelectorAll('.scenario-item').forEach(item => item.classList.remove('selected'));
            event.currentTarget.classList.add('selected');
            document.getElementById('startTrainingBtn').disabled = false;
        }

        // Start training
        document.getElementById('startTrainingBtn').onclick = async () => {
            if (!selectedScenario) return;
            
            socket.emit('start_scenario', {
                user_id: userId,
                scenario_id: selectedScenario.scenario_id
            });
        };

        socket.on('scenario_started', (data) => {
            if (!data.success) {
                alert('Error starting scenario: ' + data.error);
                return;
            }
            
            currentStep = data.current_step;
            actionsTaken = [];
            startTime = Date.now();
            
            document.getElementById('welcomeScreen').style.display = 'none';
            document.getElementById('skillAssessment').style.display = 'none';
            document.getElementById('trainingStep').classList.add('active');
            document.getElementById('trainingStatus').style.display = 'inline-block';
            document.getElementById('trainingStatus').textContent = 'Training Active';
            
            renderStep();
            startTimer();
        });

        function renderStep() {
            if (!currentStep) return;
            
            document.getElementById('stepTitle').textContent = currentStep.title;
            document.getElementById('stepDescription').textContent = currentStep.description;
            
            // Instructions
            const instructionsList = document.getElementById('instructionsList');
            instructionsList.innerHTML = '';
            currentStep.instructions.forEach(instruction => {
                const li = document.createElement('li');
                li.textContent = instruction;
                instructionsList.appendChild(li);
            });
            
            // Action buttons
            const actionButtons = document.getElementById('actionButtons');
            actionButtons.innerHTML = '';
            currentStep.expected_actions.forEach(action => {
                const btn = document.createElement('button');
                btn.className = 'action-btn';
                btn.textContent = formatActionName(action);
                btn.onclick = () => takeAction(action, btn);
                actionButtons.appendChild(btn);
            });
        }

        function formatActionName(action) {
            return action.split('_').map(word => 
                word.charAt(0).toUpperCase() + word.slice(1)
            ).join(' ');
        }

        function takeAction(action, button) {
            if (!actionsTaken.includes(action)) {
                actionsTaken.push(action);
                button.classList.add('taken');
                
                showFeedback(`Action completed: ${formatActionName(action)}`);
            }
        }

        function showFeedback(message) {
            const feedbackBox = document.getElementById('feedbackBox');
            document.getElementById('feedbackText').textContent = message;
            feedbackBox.classList.add('show');
            
            setTimeout(() => feedbackBox.classList.remove('show'), 3000);
        }

        // Complete step
        document.getElementById('completeStepBtn').onclick = () => {
            if (actionsTaken.length === 0) {
                alert('Please take at least one action before completing this step.');
                return;
            }
            
            const score = Math.min(currentStep.points, 
                Math.floor(currentStep.points * (actionsTaken.length / currentStep.expected_actions.length)));
            
            socket.emit('complete_step', {
                user_id: userId,
                scenario_id: selectedScenario.scenario_id,
                step_id: currentStep.step_id,
                score: score,
                actions_taken: actionsTaken
            });
        };

        socket.on('step_completed', (data) => {
            if (!data.success) {
                alert('Error completing step: ' + data.error);
                return;
            }
            
            document.getElementById('currentScore').textContent = data.total_score;
            showFeedback(`Step completed! +${data.score} points`);
            
            if (data.scenario_complete) {
                stopTimer();
                alert(data.passed ? 'üéâ Congratulations! You passed!' : 'üòî Training incomplete. Try again!');
                resetTraining();
            } else if (data.next_step) {
                currentStep = data.next_step;
                actionsTaken = [];
                renderStep();
            }
        });

        // Hint system
        document.getElementById('hintBtn').onclick = () => {
            socket.emit('request_hint', {
                user_id: userId,
                scenario_id: selectedScenario.scenario_id
            });
        };

        socket.on('hint_provided', (data) => {
            if (data.success) {
                showFeedback(`üí° Hint: ${data.hint}`);
                const hintsCount = parseInt(document.getElementById('hintsUsed').textContent);
                document.getElementById('hintsUsed').textContent = hintsCount + 1;
            } else {
                showFeedback('No more hints available for this step.');
            }
        });

        // Timer
        function startTimer() {
            timerInterval = setInterval(() => {
                const elapsed = Math.floor((Date.now() - startTime) / 1000);
                const minutes = Math.floor(elapsed / 60);
                const seconds = elapsed % 60;
                document.getElementById('timeSpent').textContent = 
                    `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
            }, 1000);
        }

        function stopTimer() {
            if (timerInterval) {
                clearInterval(timerInterval);
                timerInterval = null;
            }
        }

        function resetTraining() {
            document.getElementById('trainingStep').classList.remove('active');
            document.getElementById('welcomeScreen').style.display = 'block';
            document.getElementById('trainingStatus').style.display = 'none';
            stopTimer();
        }

        // Skill assessment
        document.getElementById('assessSkillsBtn').onclick = () => {
            socket.emit('assess_skills', { user_id: userId });
        };

        socket.on('skills_assessed', (data) => {
            if (!data.success) return;
            
            document.getElementById('welcomeScreen').style.display = 'none';
            document.getElementById('trainingStep').classList.remove('active');
            document.getElementById('skillAssessment').style.display = 'block';
            
            document.getElementById('skillLevel').textContent = data.skill_level.toUpperCase();
            document.getElementById('overallScore').textContent = data.overall_score;
            
            // Category scores
            const container = document.getElementById('categoryScores');
            container.innerHTML = '';
            Object.entries(data.category_scores).forEach(([category, score]) => {
                const div = document.createElement('div');
                div.className = 'category-score';
                div.innerHTML = `
                    <div class="category-name">${category.charAt(0).toUpperCase() + category.slice(1)}: ${score}/100</div>
                    <div class="category-bar">
                        <div class="category-fill" style="width: ${score}%"></div>
                    </div>
                `;
                container.appendChild(div);
            });
            
            // Strengths
            const strengthsList = document.getElementById('strengthsList');
            strengthsList.innerHTML = '';
            data.strengths.forEach(strength => {
                const li = document.createElement('li');
                li.textContent = strength;
                strengthsList.appendChild(li);
            });
            
            // Weaknesses
            const weaknessesList = document.getElementById('weaknessesList');
            weaknessesList.innerHTML = '';
            data.weaknesses.forEach(weakness => {
                const li = document.createElement('li');
                li.textContent = weakness;
                weaknessesList.appendChild(li);
            });
            
            // Recommendations
            const recommendationsList = document.getElementById('recommendationsList');
            recommendationsList.innerHTML = '';
            data.recommended_scenarios.forEach(scenario => {
                const li = document.createElement('li');
                li.textContent = formatActionName(scenario);
                recommendationsList.appendChild(li);
            });
        });

        document.getElementById('backToTrainingBtn').onclick = () => {
            document.getElementById('skillAssessment').style.display = 'none';
            document.getElementById('welcomeScreen').style.display = 'block';
        };
    </script>
</body>
</html>
